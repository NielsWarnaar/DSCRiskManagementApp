@page "/UpdateRisk"

@inject HttpClient Http
@inject NavigationManager NavigationManager
@inject RiskBean RiskBean
@inject RiskService RiskService
@using RiskManagementShared.Models
@using RiskManagementShared.Services
@using RiskManagementShared.Beans

<h3>UpdateRisk</h3>

@if (Risk == null)
{
    <h4>Loading...</h4>
}
else
{
    <EditForm Model="risk" OnValidSubmit="@Update">

        <div>
            <label>RiskName</label>
            <InputText class="forn-control" id="RiskName" @bind-Value="risk.RiskName" placeholder="@Risk.RiskName" />
        </div>

        <div>
            <label>Categorie</label>
            <InputNumber class="forn-control" id="Categorie" @bind-Value="risk.CategoryId" placeholder="@Risk.CategoryId" />
        </div>

        <div>
            <label>Description</label>
            <InputText class="forn-control" id="Description" @bind-Value="risk.Description" placeholder="@Risk.Description" />
        </div>

        <div>
            <label>ActionType</label>
            <InputText class="forn-control" id="ActionType" @bind-Value="risk.ActionType" placeholder="@Risk.ActionType" />
        </div>

        <div>
            <label>OutstandingActions</label>
            <InputText class="forn-control" id="OutstandingActions" @bind-Value="risk.OutstandingActions" placeholder="@Risk.OutstandingActions" />
        </div>

        <div>
            <label>Classification</label>
            <InputText class="forn-control" id="Classification" @bind-Value="risk.Classification" placeholder="@Risk.Classification" />
        </div>

        <div>
            <label>CreationDate</label>
            <InputDate class="forn-control" id="CreationDate" @bind-Value="risk.CreationDate" placeholder="@Risk.CreationDate" />
        </div>

        <div>
            <label>LastUpdated</label>
            <InputDate class="forn-control" id="LastUpdated" @bind-Value="risk.LastUpdated" placeholder="@Risk.LastUpdated" />
        </div>

        <div>
            <label>DueDate</label>
            <InputDate class="forn-control" id="DueDate" @bind-Value="risk.DueDate" placeholder="@Risk.DueDate" />
        </div>

        <button type="submit" class="btn btn-primary">Update risico</button>

        </EditForm>
}

@code {
    private int RiskId { get; set; }
    public Risk Risk { get; set; } = new();
    private Risk risk = new();

    protected override void OnInitialized()
    {
        base.OnInitialized();
        risk.LastUpdated = DateTime.Now;
        RiskId = RiskBean.GetRiskId();
        risk.RiskId = RiskId;
    }

    protected override async Task OnInitializedAsync()
    {
        risk = await RiskService.GetRisk(RiskId);
    } 

    private async Task Update()
    {
        var response = await Http.PutAsJsonAsync($"/api/Risks/{RiskId}",risk);
        NavigationManager.NavigateTo("/");
    }
}
